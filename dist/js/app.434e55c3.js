(function(){"use strict";var e={5936:function(e,t,a){var o=a(6848),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},s=[],l={name:"App",data(){return{msg:"这是我的第一个vue项目"}}},i=l,n=a(1656),c=(0,n.A)(i,r,s,!1,null,null,null),d=c.exports,u=a(6178),p=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"login-wrapper"},[t("div",{staticClass:"login-box"},[t("h2",{staticClass:"title"},[e._v("捷储通")]),t("p",{staticClass:"subtitle"},[e._v("智能仓储管理系统")]),t("el-form",{attrs:{model:e.user,"label-width":"0"}},[t("el-form-item",[t("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"请输入用户名"},model:{value:e.user.username,callback:function(t){e.$set(e.user,"username",t)},expression:"user.username"}})],1),t("el-form-item",[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",type:"password",placeholder:"请输入密码","show-password":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.user.password,callback:function(t){e.$set(e.user,"password",t)},expression:"user.password"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{type:"primary"},on:{click:e.login}},[e._v(" 登 录 ")]),t("el-button",{staticStyle:{width:"100%","margin-left":"0"},attrs:{type:"text"},on:{click:e.addUser}},[e._v(" 没有账号？点击注册新用户 ")])],1)],1)],1)])},m=[],h=(a(4114),{name:"userLogin",data(){return{user:{username:"",password:""},fullscreenLoading:!1}},methods:{login(){this.user.username&&this.user.password?(this.fullscreenLoading=!0,this.$xhr.post("/login",this.user).then(e=>{if(0===e.code){const t=e.data,a=t.charAt(0),o=t.substring(1);sessionStorage.setItem("roleId",a),sessionStorage.setItem("token",o),sessionStorage.setItem("username",this.user.username),this.$message.success("登录成功!"),this.$router.push({name:"Welcome"})}else this.$message.error(e.msg||"登录失败");this.fullscreenLoading=!1}).catch(e=>{console.error(e),this.fullscreenLoading=!1})):this.$message.warning("请输入用户名和密码")},addUser(){this.$router.push({name:"NewUser"})}}}),f=h,g=(0,n.A)(f,p,m,!1,null,"40f96cc7",null),b=g.exports,v=function(){var e=this,t=e._self._c;return t("el-container",{staticStyle:{height:"100vh"}},[t("el-aside",{staticStyle:{"background-color":"#001529","overflow-x":"hidden"},attrs:{width:"220px"}},[t("div",{staticClass:"sys-logo"},[e._v("捷储通·WMS")]),t("el-menu",{staticStyle:{border:"none"},attrs:{"default-active":e.$route.path,router:"","background-color":"#001529","text-color":"rgba(255,255,255,0.7)","active-text-color":"#409EFF"}},[t("el-menu-item",{attrs:{index:"/welcome/dashboard"}},[t("i",{staticClass:"el-icon-s-data"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("数据可视化")])]),t("el-menu-item",{attrs:{index:"/welcome/sales"}},[t("i",{staticClass:"el-icon-shopping-cart-2"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("销售管理")])]),t("el-menu-item",{attrs:{index:"/welcome/products"}},[t("i",{staticClass:"el-icon-box"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("商品管理")])]),t("el-menu-item",{attrs:{index:"/welcome/documents"}},[t("i",{staticClass:"el-icon-document-copy"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("单据管理")])]),t("el-menu-item",{attrs:{index:"/welcome/locations"}},[t("i",{staticClass:"el-icon-location-outline"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("库位管理")])]),t("el-menu-item",{attrs:{index:"/welcome/logs"}},[t("i",{staticClass:"el-icon-notebook-2"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("库存日志")])]),e.isAdmin?t("el-menu-item",{attrs:{index:"/welcome/users"}},[t("i",{staticClass:"el-icon-user"}),t("span",{attrs:{slot:"title"},slot:"title"},[e._v("用户管理")])]):e._e()],1)],1),t("el-container",[t("el-header",{staticStyle:{background:"#fff","box-shadow":"0 1px 4px rgba(0,21,41,.08)",display:"flex","justify-content":"space-between","align-items":"center",height:"60px"}},[t("div",{staticClass:"header-left"},[t("span",{staticClass:"breadcrumb-text"},[e._v(e._s(e.$route.meta.title))])]),t("div",{staticClass:"header-right"},[t("el-dropdown",{on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link",staticStyle:{cursor:"pointer",color:"#333"}},[t("i",{staticClass:"el-icon-user-solid"}),e._v(" "+e._s(e.username)+" "),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"logout",icon:"el-icon-switch-button"}},[e._v("退出登录")])],1)],1)],1)]),t("el-main",{staticStyle:{"background-color":"#f0f2f5",padding:"20px"}},[t("router-view")],1)],1)],1)},y=[],w={name:"WelcomeLayout",data(){return{roleId:sessionStorage.getItem("roleId"),username:sessionStorage.getItem("username")}},computed:{isAdmin(){return"1"===this.roleId}},methods:{handleCommand(e){"logout"===e&&(sessionStorage.clear(),this.$message.success("已安全退出"),this.$router.push("/login"))}}},k=w,_=(0,n.A)(k,v,y,!1,null,"30db9516",null),x=_.exports,S=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard-container"},[t("div",{staticClass:"header-banner"},[t("div",{staticClass:"header-content"},[t("h1",[e._v("仓库数据概览")]),t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-refresh"},on:{click:e.fetchData}},[e._v("刷新数据")])],1)]),t("el-row",{staticClass:"mb-20",attrs:{gutter:20}},e._l(e.kpiCards,function(a,o){return t("el-col",{key:o,attrs:{span:8}},[t("el-card",{attrs:{shadow:"hover","body-style":{padding:"20px"}}},[t("div",{staticStyle:{display:"flex","align-items":"center"}},[t("div",{class:["icon-wrap","bg-"+o]},[t("i",{class:a.icon})]),t("div",{staticStyle:{"margin-left":"15px"}},[t("div",{staticStyle:{color:"#909399","font-size":"14px"}},[e._v(e._s(a.label))]),t("div",{staticStyle:{"font-size":"24px","font-weight":"bold","margin-top":"5px"}},[e._v(e._s(a.value))])])])])],1)}),1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:16}},[t("el-card",{attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("销售与利润趋势")])]),t("div",{ref:"trendChart",staticStyle:{height:"350px"}})])],1),t("el-col",{attrs:{span:8}},[t("el-card",{attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("分类占比")])]),t("div",{ref:"pieChart",staticStyle:{height:"350px"}})])],1)],1),t("el-card",{staticStyle:{"margin-top":"20px"},attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("本月销售详情")])]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,height:"300"}},[t("el-table-column",{attrs:{prop:"proName",label:"商品名称"}}),t("el-table-column",{attrs:{prop:"category",label:"分类",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small"}},[e._v(e._s(a.row.category))])]}}])}),t("el-table-column",{attrs:{prop:"salesCount",label:"销量",sortable:""}}),t("el-table-column",{attrs:{prop:"salesAmount",label:"销售额(元)",sortable:""}}),t("el-table-column",{attrs:{prop:"lastSaleTime",label:"最近交易时间"}})],1)],1)],1)},$=[],C=a(9671),D={name:"DashboardView",data(){return{loading:!1,kpiCards:[{label:"总订单数",value:0,icon:"el-icon-s-order"},{label:"总销售额",value:0,icon:"el-icon-money"},{label:"总利润",value:0,icon:"el-icon-wallet"}],tableData:[],charts:{trend:null,pie:null}}},mounted(){this.charts.trend=C.Ts(this.$refs.trendChart),this.charts.pie=C.Ts(this.$refs.pieChart),this.fetchData(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){window.removeEventListener("resize",this.handleResize)},methods:{async fetchData(){this.loading=!0;try{const e=await this.$xhr.post("/api/dashboard/data",{});if(console.log("Dashboard Data:",e),e&&(e.kpi||e.trends||e.tableData)){const t=e;t.kpi&&(this.kpiCards[0].value=t.kpi.totalCount||0,this.kpiCards[1].value=t.kpi.totalAmount||0,this.kpiCards[2].value=t.kpi.totalProfit||0,t.kpi.details&&t.kpi.details.length>0&&this.updatePieChart(t.kpi.details[0])),this.tableData=t.tableData||[],t.trends&&this.updateTrendChart(t.trends)}else if(e&&0===e.code&&e.data){const t=e.data;t.kpi&&(this.kpiCards[0].value=t.kpi.totalCount||0,this.kpiCards[1].value=t.kpi.totalAmount||0,this.kpiCards[2].value=t.kpi.totalProfit||0,t.kpi.details&&t.kpi.details.length>0&&this.updatePieChart(t.kpi.details[0])),this.tableData=t.tableData||[],t.trends&&this.updateTrendChart(t.trends)}else console.warn("数据格式不匹配，无法渲染")}catch(e){console.error("获取数据失败",e)}finally{this.loading=!1}},updateTrendChart(e){const t={tooltip:{trigger:"axis"},legend:{data:["销售额","利润"]},xAxis:{type:"category",data:e.years},yAxis:{type:"value"},series:[{name:"销售额",type:"line",data:e.amount,smooth:!0,itemStyle:{color:"#409EFF"}},{name:"利润",type:"line",data:e.profit,smooth:!0,itemStyle:{color:"#67C23A"}}]};this.charts.trend.setOption(t)},updatePieChart(e){const t={tooltip:{trigger:"item"},series:[{type:"pie",radius:["40%","70%"],data:e,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2}}]};this.charts.pie.setOption(t)},handleResize(){this.charts.trend&&this.charts.trend.resize(),this.charts.pie&&this.charts.pie.resize()}}},I=D,F=(0,n.A)(I,S,$,!1,null,"dbbc503e",null),P=F.exports,N=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between"},attrs:{slot:"header"},slot:"header"},[t("div",[t("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"输入商品名称搜索",size:"small",clearable:""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t("div",[e.isAdmin?t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.handleAdd}},[e._v("新增商品")]):e._e(),t("el-button",{attrs:{icon:"el-icon-refresh",size:"small"},on:{click:e.fetchData}},[e._v("刷新")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.filteredData,border:""}},[t("el-table-column",{attrs:{prop:"proId",label:"ID",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"proName",label:"商品名称","min-width":"120"}}),t("el-table-column",{attrs:{prop:"proCategory",label:"分类",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small",type:"info"}},[e._v(e._s(a.row.proCategory))])]}}])}),t("el-table-column",{attrs:{prop:"proPrice",label:"单价",width:"100",sortable:"",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥ "+e._s(t.row.proPrice))]}}])}),t("el-table-column",{attrs:{prop:"proNum",label:"库存",width:"120",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.proNum<=10?t("div",{staticStyle:{color:"red","font-weight":"bold"}},[t("i",{staticClass:"el-icon-warning"}),e._v(" "+e._s(a.row.proNum)+" ")]):t("div",{staticStyle:{color:"#67C23A","font-weight":"bold"}},[e._v(" "+e._s(a.row.proNum)+" ")])]}}])}),t("el-table-column",{attrs:{label:"快捷操作",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button-group",[t("el-button",{attrs:{size:"mini",type:"success",plain:""},on:{click:function(t){return e.openStockDialog(a.row,"入库")}}},[e._v("入库")]),t("el-button",{attrs:{size:"mini",type:"warning",plain:""},on:{click:function(t){return e.openStockDialog(a.row,"出库")}}},[e._v("出库")])],1)]}}])}),e.isAdmin?t("el-table-column",{attrs:{label:"管理",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(t){return e.handleEdit(a.row)}}}),t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.handleDelete(a.row)}}})]}}],null,!1,2710818787)}):e._e()],1)],1),e.isAdmin?t("el-dialog",{attrs:{title:e.form.proId?"编辑商品":"新增商品",visible:e.dialogVisible,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{attrs:{model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"商品名称"}},[t("el-input",{model:{value:e.form.proName,callback:function(t){e.$set(e.form,"proName",t)},expression:"form.proName"}})],1),t("el-form-item",{attrs:{label:"商品分类"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.proCategory,callback:function(t){e.$set(e.form,"proCategory",t)},expression:"form.proCategory"}},[t("el-option",{attrs:{value:"电子产品",label:"电子产品"}}),t("el-option",{attrs:{value:"办公用品",label:"办公用品"}}),t("el-option",{attrs:{value:"家具",label:"家具"}})],1)],1),t("el-form-item",{attrs:{label:"价格"}},[t("el-input-number",{attrs:{precision:2,step:.1},model:{value:e.form.proPrice,callback:function(t){e.$set(e.form,"proPrice",t)},expression:"form.proPrice"}})],1),t("el-form-item",{attrs:{label:"初始库存"}},[t("el-input-number",{attrs:{min:0,disabled:!!e.form.proId},model:{value:e.form.proNum,callback:function(t){e.$set(e.form,"proNum",t)},expression:"form.proNum"}})],1),t("el-form-item",{attrs:{label:"描述"}},[t("el-input",{attrs:{type:"textarea"},model:{value:e.form.proDesc,callback:function(t){e.$set(e.form,"proDesc",t)},expression:"form.proDesc"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确定")])],1)],1):e._e(),t("el-dialog",{attrs:{title:e.stockForm.type+"登记",visible:e.stockDialogVisible,width:"400px"},on:{"update:visible":function(t){e.stockDialogVisible=t}}},[t("el-form",{attrs:{model:e.stockForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"商品名称"}},[t("el-input",{attrs:{disabled:""},model:{value:e.stockForm.proName,callback:function(t){e.$set(e.stockForm,"proName",t)},expression:"stockForm.proName"}})],1),t("el-form-item",{attrs:{label:"当前库存"}},[t("el-tag",[e._v(e._s(e.stockForm.currentNum))])],1),t("el-form-item",{attrs:{label:e.stockForm.type+"数量"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{min:1},model:{value:e.stockForm.docCount,callback:function(t){e.$set(e.stockForm,"docCount",t)},expression:"stockForm.docCount"}})],1),t("el-form-item",{attrs:{label:"经办人"}},[t("el-input",{attrs:{disabled:""},model:{value:e.stockForm.handler,callback:function(t){e.$set(e.stockForm,"handler",t)},expression:"stockForm.handler"}})],1)],1),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.stockDialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitStock}},[e._v("提交单据")])],1)],1)],1)},A=[],z=(a(8111),a(2489),{name:"ProductManagerPage",data(){return{loading:!1,tableData:[],search:"",dialogVisible:!1,form:{proId:null,proName:"",proCategory:"",proPrice:0,proNum:0,proDesc:""},stockDialogVisible:!1,stockForm:{proId:null,proName:"",currentNum:0,type:"入库",docCount:1,handler:""},roleId:sessionStorage.getItem("roleId")||"2"}},computed:{filteredData(){return this.search?this.tableData.filter(e=>!this.search||e.proName.toLowerCase().includes(this.search.toLowerCase())):this.tableData},isAdmin(){return"1"===this.roleId}},created(){this.fetchData(),this.$root.$on("documentApproved",()=>{this.fetchData()})},beforeDestroy(){this.$root.$off("documentApproved")},methods:{async fetchData(){this.loading=!0;try{const e=await this.$xhr.get("/product/list");0===e.code&&(this.tableData=e.data)}catch(e){console.error(e)}finally{this.loading=!1}},handleAdd(){this.form={proId:null,proName:"",proCategory:"",proPrice:0,proNum:0,proDesc:""},this.dialogVisible=!0},handleEdit(e){this.form={...e},this.dialogVisible=!0},async handleDelete(e){try{await this.$confirm("确认删除该商品吗?","提示",{type:"warning"}),await this.$xhr.post("/product/delete",e),this.$message.success("删除成功"),this.fetchData()}catch(t){}},async submitForm(){const e=this.form.proId?"/product/update":"/product/add";try{await this.$xhr.post(e,this.form),this.$message.success("操作成功"),this.dialogVisible=!1,this.fetchData()}catch(t){console.error(t)}},openStockDialog(e,t){this.stockForm={proId:e.proId,proName:e.proName,currentNum:e.proNum,type:t,docCount:1,handler:sessionStorage.getItem("username")||"管理员"},this.stockDialogVisible=!0},async submitStock(){const e={docType:"入库"===this.stockForm.type?"采购入库":"领料出库",proId:this.stockForm.proId,docCount:this.stockForm.docCount,docHandler:this.stockForm.handler,docStatus:"待审核",picIds:[]};try{const t=await this.$xhr.post("/document/add",e);0===t.code?(this.$message.success(`${this.stockForm.type}单据已创建，请前往单据管理审核`),this.stockDialogVisible=!1):this.$message.error(t.msg)}catch(t){console.error(t)}}}}),T=z,L=(0,n.A)(T,N,A,!1,null,null,null),V=L.exports,R=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("el-card",{attrs:{shadow:"never"}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between"},attrs:{slot:"header"},slot:"header"},[t("div",[t("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"搜索经办人/单据号",size:"small"},model:{value:e.searchKeyword,callback:function(t){e.searchKeyword=t},expression:"searchKeyword"}}),t("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:e.fetchData}},[e._v("查询")])],1),t("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"small"},on:{click:e.preAdd}},[e._v("新建单据")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.filteredData,border:""}},[t("el-table-column",{attrs:{prop:"docId",label:"单据号",width:"100"}}),t("el-table-column",{attrs:{prop:"docType",label:"类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:["入库","采购入库","退货入库","调拨入库","盘盈入库"].includes(a.row.docType)?"success":"warning",effect:"dark"}},[e._v(e._s(a.row.docType))])]}}])}),t("el-table-column",{attrs:{label:"关联商品","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[e._v(e._s(e.getProductName(a.row.proId)))]),t("div",{staticStyle:{color:"#999","font-size":"12px"}},[e._v("数量: "+e._s(a.row.docCount))])]}}])}),t("el-table-column",{attrs:{prop:"docStatus",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:{color:"已完成"===a.row.docStatus?"#67C23A":"#F56C6C",fontWeight:"bold"}},[e._v(" "+e._s(a.row.docStatus)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"transactionType",label:"出入库方式",width:"120"}}),t("el-table-column",{attrs:{prop:"creationTime",label:"创建时间",width:"160"}}),t("el-table-column",{attrs:{label:"经办人",prop:"docHandler"}}),t("el-table-column",{attrs:{label:"操作",width:"220",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},["已完成"!==a.row.docStatus&&e.isAdmin?t("el-button",{staticStyle:{color:"#67C23A","font-weight":"bold"},attrs:{type:"text",size:"small",icon:"el-icon-check"},on:{click:function(t){return e.handleApprove(a.row)}}},[e._v(" 审核 ")]):e._e(),"已完成"!==a.row.docStatus&&e.isAdmin?t("el-divider",{attrs:{direction:"vertical"}}):e._e(),t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-view"},on:{click:function(t){return e.preView(a.row)}}},[e._v(" 详情 ")]),"已完成"!==a.row.docStatus||e.isAdmin?t("el-divider",{attrs:{direction:"vertical"}}):e._e(),"已完成"!==a.row.docStatus||e.isAdmin?t("el-button",{staticStyle:{color:"#F56C6C"},attrs:{type:"text",size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.deleteDocument(a.row)}}},[e._v(" 删除 ")]):e._e()],1)]}}])})],1)],1),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,width:"600px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[t("el-form",{ref:"docForm",attrs:{model:e.form,"label-width":"100px",rules:e.rules,disabled:e.isViewMode}},[t("el-form-item",{attrs:{label:"单据类型",prop:"docType"}},[t("el-radio-group",{model:{value:e.form.docType,callback:function(t){e.$set(e.form,"docType",t)},expression:"form.docType"}},[t("el-radio",{attrs:{label:"采购入库",border:""}},[e._v("采购入库")]),t("el-radio",{attrs:{label:"销售出库",border:""}},[e._v("销售出库")])],1)],1),t("el-form-item",{attrs:{label:"选择商品",prop:"proId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择商品",filterable:""},model:{value:e.form.proId,callback:function(t){e.$set(e.form,"proId",t)},expression:"form.proId"}},e._l(e.productList,function(e){return t("el-option",{key:e.proId,attrs:{label:e.proName,value:e.proId}})}),1)],1),t("el-form-item",{attrs:{label:"操作数量",prop:"docCount"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{min:1},model:{value:e.form.docCount,callback:function(t){e.$set(e.form,"docCount",t)},expression:"form.docCount"}})],1),t("el-form-item",{attrs:{label:"出入库方式",prop:"docType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择出入库方式"},model:{value:e.form.docType,callback:function(t){e.$set(e.form,"docType",t)},expression:"form.docType"}},e._l(e.transactionTypes,function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),t("el-form-item",{attrs:{label:"经办人",prop:"docHandler"}},[t("el-input",{attrs:{disabled:!0},model:{value:e.form.docHandler,callback:function(t){e.$set(e.form,"docHandler",t)},expression:"form.docHandler"}})],1),t("el-form-item",{attrs:{label:"单据图片"}},[t("el-upload",{attrs:{action:e.uploadUrl,"list-type":"picture-card","on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,headers:e.headers,"on-success":e.uploadSuccess,"file-list":e.fileList,disabled:e.isViewMode||!e.isAdmin&&"已完成"===e.form.docStatus},scopedSlots:e._u([{key:"file",fn:function({file:a}){return t("div",{staticStyle:{width:"100%",height:"100%"}},[t("img",{staticClass:"el-upload-list__item-thumbnail",staticStyle:{width:"100%",height:"100%","object-fit":"cover"},attrs:{src:a.url,alt:""}}),t("span",{staticClass:"el-upload-list__item-actions"},[t("span",{staticClass:"el-upload-list__item-preview",on:{click:function(t){return e.handlePictureCardPreview(a)}}},[t("i",{staticClass:"el-icon-zoom-in"})]),"已完成"!==e.form.docStatus?t("span",{staticClass:"el-upload-list__item-delete",on:{click:function(t){return e.handleRemove(a,e.fileList)}}},[t("i",{staticClass:"el-icon-delete"})]):e._e()])])}}])},[t("i",{staticClass:"el-icon-plus"})]),t("el-dialog",{attrs:{visible:e.picDialogVisible,modal:!1},on:{"update:visible":function(t){e.picDialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:"单据图片"}})])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(" "+e._s(e.isViewMode?"关 闭":"取 消")+" ")]),e.isViewMode?e._e():t("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.addOrUpdate}},[e._v(" 确 定 ")])],1)],1)],1)},E=[],U=(a(116),a(7588),{data(){return{loading:!1,searchKeyword:"",tableData:[],productList:[],currentUserRole:"2",currentUsername:"",submitting:!1,dialogFormVisible:!1,dialogTitle:"",isViewMode:!1,form:{docType:"采购入库",docHandler:"",docStatus:"待审核",picIds:[],proId:null,docCount:1},transactionTypes:[{value:"采购入库",label:"采购入库"},{value:"退货入库",label:"退货入库"},{value:"调拨入库",label:"调拨入库"},{value:"盘盈入库",label:"盘盈入库"},{value:"销售出库",label:"销售出库"},{value:"领料出库",label:"领料出库"},{value:"调拨出库",label:"调拨出库"},{value:"盘亏出库",label:"盘亏出库"}],fileList:[],dialogImageUrl:"",picDialogVisible:!1,uploadUrl:"http://localhost:8888/docPic/save",headers:{Authorization:`Bearer ${this.getToken()}`},rules:{docType:[{required:!0,message:"请选择出入库方式",trigger:"change"}],proId:[{required:!0,message:"请选择商品",trigger:"change"}],docCount:[{required:!0,message:"请输入数量",trigger:"blur"}],docHandler:[{required:!0,message:"请输入经办人",trigger:"blur"}]}}},computed:{filteredData(){let e=this.tableData;if("2"===this.currentUserRole&&(e=e.filter(e=>"已完成"===e.docStatus||e.docHandler===this.currentUsername)),this.searchKeyword){const t=this.searchKeyword.toLowerCase();e=e.filter(e=>e.docHandler&&e.docHandler.toLowerCase().includes(t)||e.docId&&String(e.docId).includes(t))}return e},isAdmin(){return"1"===this.currentUserRole}},created(){this.currentUserRole=sessionStorage.getItem("roleId")||"2",this.currentUsername=sessionStorage.getItem("username")||"",this.fetchData(),this.fetchProducts()},methods:{getToken(){return sessionStorage.getItem("token")},async fetchData(){this.loading=!0;const e=await this.$xhr.get("/document/list");0===e.code&&(this.tableData=e.data),this.loading=!1},async fetchProducts(){const e=await this.$xhr.get("/product/list");0===e.code&&(this.productList=e.data)},getProductName(e){const t=this.productList.find(t=>t.proId===e);return t?t.proName:"未知商品"},preAdd(){this.dialogTitle="新建出入库单据",this.isViewMode=!1,this.fileList=[];const e=sessionStorage.getItem("username")||"管理员";this.form={docType:"采购入库",docHandler:e,docStatus:"待审核",picIds:[],proId:null,docCount:1},this.dialogFormVisible=!0,this.$nextTick(()=>{this.$refs.docForm&&this.$refs.docForm.clearValidate()})},addOrUpdate(){this.$refs.docForm.validate(async e=>{if(e){this.submitting=!0;try{const e=this.form.docId?"/document/update":"/document/add",t=await this.$xhr.post(e,this.form);0===t.code?(this.$message.success(this.form.docId?"修改成功":"创建成功"),this.dialogFormVisible=!1,this.fetchData()):this.$message.error(t.msg)}catch(t){console.error(t),this.$message.error("操作失败")}finally{this.submitting=!1}}})},preView(e){if("2"===this.currentUserRole&&"已完成"===e.docStatus){if(this.isViewMode=!0,e.docHandler!==this.currentUsername)return void this.$message.warning("此单据已完成，请勿重复操作")}else"已完成"===e.docStatus?this.isViewMode=!0:this.isViewMode=!1;this.dialogTitle=this.isViewMode?"单据详情":"编辑单据",this.form={...e},this.fileList=[],this.form.picIds||(this.form.picIds=[]),this.$xhr.get(`/docPic/getPics/${e.docId}`).then(e=>{if(0===e.code){const t=e.data;t.forEach(e=>{const t=e.picPath.startsWith("http")?e.picPath:"http://localhost:8888"+e.picPath;this.fileList.push({name:e.picPath,url:t,response:{data:{docPicId:e.docPicId}},rawId:e.docPicId})})}this.dialogFormVisible=!0})},uploadSuccess(e){0===e.code?(this.form.picIds||(this.form.picIds=[]),this.form.picIds.push(e.data.docPicId)):this.$message.error("图片上传失败: "+e.msg)},deletePic(e){this.$xhr.post("/docPic/deletePic",{url:e.url}).then(e=>{0==e.code?(this.$message.success("删除成功！"),this.fetchData()):this.$message.error(e.msg)})},handleRemove(e,t){this.fileList=[...t],this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deletePic(e),this.fileList=this.fileList.filter(t=>t.rawId!==e.rawId)}).catch(()=>{this.$message({type:"info",message:"已取消删除"}),this.fileList.push(e)})},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.picDialogVisible=!0},async handleApprove(e){try{await this.$confirm("确认审核通过？\n库存将自动更新。","提示",{type:"warning"});const t=await this.$xhr.post("/document/approve",{docId:e.docId,operator:"管理员"});0===t.code?(this.$message.success("审核成功"),this.fetchData(),this.$root.$emit("documentApproved")):this.$message.error(t.msg||"审核失败")}catch(t){console.error(t),this.$message.error("审核过程中发生错误，请查看控制台了解详细信息")}},async deleteDocument(e){try{let t="确认删除该单据吗?";"已完成"===e.docStatus&&(t="⚠️ 警告：该单据已审核生效！\n删除后可能会导致库存数据不一致（需手动修正库存）。\n确认强制删除吗？"),await this.$confirm(t,"高风险操作提示",{type:"warning",confirmButtonText:"强制删除",cancelButtonText:"取消"}),await this.$xhr.post("/document/delete",e),this.$message.success("删除成功"),this.fetchData(),"已完成"===e.docStatus&&this.$root.$emit("documentApproved")}catch(t){console.log("已取消")}}}}),M=U,q=(0,n.A)(M,R,E,!1,null,null,null),j=q.exports,O=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("el-card",{attrs:{shadow:"never"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("新增库位")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.fetchData}},[e._v("刷新")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{prop:"locationCode",label:"库位编码",width:"150",sortable:""}}),t("el-table-column",{attrs:{prop:"product",label:"存放商品"}}),t("el-table-column",{attrs:{prop:"locationStatus",label:"状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{type:"空闲"===a.row.locationStatus?"success":"danger"}},[e._v(" "+e._s(a.row.locationStatus)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"locationAttributes",label:"属性(如:冷藏/常温)"}}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[e.isAdmin?t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑")]):e._e(),e.isAdmin?t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")]):e._e(),e.isAdmin?e._e():t("span",[e._v("无权限")])]}}])})],1)],1),e.isAdmin?t("el-dialog",{attrs:{title:e.form.isEdit?"编辑库位":"新增库位",visible:e.dialogVisible,width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{attrs:{model:e.form,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"库位编码"}},[t("el-input",{attrs:{disabled:e.form.isEdit},model:{value:e.form.locationCode,callback:function(t){e.$set(e.form,"locationCode",t)},expression:"form.locationCode"}})],1),t("el-form-item",{attrs:{label:"存放商品"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择商品（可多选）",filterable:"",multiple:"",clearable:""},model:{value:e.form.product,callback:function(t){e.$set(e.form,"product",t)},expression:"form.product"}},e._l(e.productList,function(e){return t("el-option",{key:e.proId,attrs:{label:e.proName,value:e.proName}})}),1)],1),t("el-form-item",{attrs:{label:"库位状态"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.locationStatus,callback:function(t){e.$set(e.form,"locationStatus",t)},expression:"form.locationStatus"}},[t("el-option",{attrs:{value:"空闲",label:"空闲"}}),t("el-option",{attrs:{value:"占用",label:"占用"}})],1)],1),t("el-form-item",{attrs:{label:"库位属性"}},[t("el-input",{attrs:{placeholder:"例如：货架A区 / 冷冻柜"},model:{value:e.form.locationAttributes,callback:function(t){e.$set(e.form,"locationAttributes",t)},expression:"form.locationAttributes"}})],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1):e._e()],1)},H=[],W=(a(1701),{name:"LocationManagerPage",data(){return{loading:!1,tableData:[],productList:[],dialogVisible:!1,form:{locationCode:"",product:[],locationStatus:"空闲",locationAttributes:"",isEdit:!1},roleId:sessionStorage.getItem("roleId")||"2"}},computed:{isAdmin(){return"1"===this.roleId}},created(){this.fetchData(),this.fetchProducts()},methods:{async fetchData(){this.loading=!0;try{const e=await this.$xhr.get("/location/all");0===e.code&&(this.tableData=e.data)}catch(e){console.error(e)}finally{this.loading=!1}},async fetchProducts(){try{const e=await this.$xhr.get("/product/list");0===e.code&&(this.productList=e.data)}catch(e){console.error(e)}},handleAdd(){this.form={locationCode:"",product:[],locationStatus:"空闲",locationAttributes:"",isEdit:!1},this.dialogVisible=!0},handleEdit(e){if(!this.isAdmin)return void this.$message.warning("权限不足，无法编辑库位");let t=[];e.product&&(t=Array.isArray(e.product)?e.product:"string"===typeof e.product?e.product.split(",").map(e=>e.trim()).filter(e=>e):[e.product]),this.form={...e,product:t,isEdit:!0},this.dialogVisible=!0},async handleDelete(e){if(this.isAdmin)try{await this.$confirm("确认删除该库位吗?","提示",{type:"warning"}),await this.$xhr.post("/location/deleteLocation",e),this.$message.success("删除成功"),this.fetchData()}catch(t){}else this.$message.warning("权限不足，无法删除库位")},async submitForm(){if(!this.isAdmin)return void this.$message.warning("权限不足，无法提交");const e={...this.form};delete e.isEdit,e.product&&Array.isArray(e.product)&&0===e.product.length?e.product="":e.product&&Array.isArray(e.product)&&1===e.product.length?e.product=e.product[0]:e.product&&Array.isArray(e.product)&&(e.product=e.product.join(","));const t=this.form.isEdit?"/location/updateLocation":"/location/addLocation";try{await this.$xhr.post(t,e),this.$message.success("操作成功"),this.dialogVisible=!1,this.fetchData()}catch(a){console.error(a),this.$message.error("操作失败："+(a.message||"未知错误"))}}}}),B=W,K=(0,n.A)(B,O,H,!1,null,null,null),G=K.exports,J=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("el-card",{attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("新增用户")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.fetchData}},[e._v("刷新")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{prop:"userId",label:"用户ID/账号",width:"150"}}),t("el-table-column",{attrs:{prop:"userName",label:"用户名"}}),t("el-table-column",{attrs:{prop:"userRole",label:"角色"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",[e._v(e._s(a.row.userRole))])]}}])}),t("el-table-column",{attrs:{prop:"userStatus",label:"状态"}}),t("el-table-column",{attrs:{prop:"creationTime",label:"创建时间",width:"180"}}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1)],1),t("el-dialog",{attrs:{title:e.form.isEdit?"编辑用户":"新增用户",visible:e.dialogVisible,width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{attrs:{model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"用户ID"}},[t("el-input",{attrs:{disabled:e.form.isEdit,placeholder:"请输入登录账号"},model:{value:e.form.userId,callback:function(t){e.$set(e.form,"userId",t)},expression:"form.userId"}})],1),t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{placeholder:"请输入显示名称"},model:{value:e.form.userName,callback:function(t){e.$set(e.form,"userName",t)},expression:"form.userName"}})],1),t("el-form-item",{attrs:{label:"密码"}},[e.form.isEdit?t("el-input",{attrs:{type:"password",placeholder:"若不修改请留空"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}}):t("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",{attrs:{label:"角色"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.userRole,callback:function(t){e.$set(e.form,"userRole",t)},expression:"form.userRole"}},[t("el-option",{attrs:{value:"管理员",label:"管理员"}}),t("el-option",{attrs:{value:"普通用户",label:"普通用户"}})],1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.form.userStatus,callback:function(t){e.$set(e.form,"userStatus",t)},expression:"form.userStatus"}},[t("el-option",{attrs:{value:"启用",label:"启用"}}),t("el-option",{attrs:{value:"禁用",label:"禁用"}})],1)],1)],1),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1)],1)},Q=[],X={name:"UserManagerPage",data(){return{loading:!1,tableData:[],dialogVisible:!1,form:{userId:"",userName:"",password:"",userRole:"普通用户",userStatus:"启用",isEdit:!1}}},created(){this.fetchData()},methods:{async fetchData(){this.loading=!0;try{const e=await this.$xhr.get("/user/all");0===e.code&&(this.tableData=e.data)}catch(e){console.error(e)}finally{this.loading=!1}},handleAdd(){this.form={userId:"",userName:"",password:"",userRole:"普通用户",userStatus:"启用",isEdit:!1},this.dialogVisible=!0},handleEdit(e){this.form={...e,password:"",isEdit:!0},this.dialogVisible=!0},async handleDelete(e){try{await this.$confirm("确认删除该用户吗?","提示",{type:"warning"}),await this.$xhr.post("/user/deleteUser",e),this.$message.success("删除成功"),this.fetchData()}catch(t){}},async submitForm(){const e={...this.form};delete e.isEdit;const t=this.form.isEdit?"/user/update":"/user/addUser";try{await this.$xhr.post(t,e),this.$message.success("操作成功"),this.dialogVisible=!1,this.fetchData()}catch(a){console.error(a)}}}},Y=X,Z=(0,n.A)(Y,J,Q,!1,null,null,null),ee=Z.exports,te=function(){var e=this,t=e._self._c;return t("div",{staticClass:"register-container"},[t("el-card",{staticClass:"register-box"},[t("div",{staticClass:"register-header",attrs:{slot:"header"},slot:"header"},[t("span",{staticClass:"header-title"},[e._v("注册新用户")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.$router.push("/login")}}},[e._v("返回登录")])],1),t("el-form",{ref:"form",attrs:{model:e.form,"status-icon":"",rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[t("el-input",{attrs:{placeholder:"请输入显示名称"},model:{value:e.form.userName,callback:function(t){e.$set(e.form,"userName",t)},expression:"form.userName"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password",autocomplete:"off",placeholder:"请输入密码"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[t("el-input",{attrs:{type:"password",autocomplete:"off",placeholder:"请再次输入密码"},model:{value:e.form.checkPass,callback:function(t){e.$set(e.form,"checkPass",t)},expression:"form.checkPass"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{type:"primary",loading:e.loading},on:{click:e.register}},[e._v("立即注册")]),t("el-button",{staticStyle:{width:"100%","margin-left":"0"},on:{click:e.resetForm}},[e._v("重置")])],1)],1)],1)],1)},ae=[],oe={name:"NewUser",data(){var e=(e,t,a)=>{""===t?a(new Error("请输入密码")):(""!==this.form.checkPass&&this.$refs.form.validateField("checkPass"),a())},t=(e,t,a)=>{""===t?a(new Error("请再次输入密码")):t!==this.form.password?a(new Error("两次输入密码不一致!")):a()};return{loading:!1,form:{userId:"",userName:"",password:"",checkPass:"",userRole:"普通用户",userStatus:"启用"},rules:{userName:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{validator:e,trigger:"change"}],checkPass:[{validator:t,trigger:"change"}]}}},methods:{register(){this.$refs.form.validate(e=>{if(!e)return console.log("error submit!!"),!1;{this.loading=!0;const e={...this.form};delete e.checkPass,this.$xhr.post("/user/addUser",e).then(e=>{0===e.code?(this.$message.success("注册成功，请登录"),this.$router.push("/login")):this.$message.error(e.msg||"注册失败")}).catch(e=>{console.error(e),this.$message.error("注册异常")}).finally(()=>{this.loading=!1})}})},resetForm(){this.$refs.form.resetFields()}}},re=oe,se=(0,n.A)(re,te,ae,!1,null,"2a567ae2",null),le=se.exports,ie=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("el-card",{attrs:{shadow:"never"}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"},attrs:{slot:"header"},slot:"header"},[t("div",{staticStyle:{"font-weight":"bold","font-size":"16px"}},[t("i",{staticClass:"el-icon-tickets"}),e._v(" 库存变动明细 ")]),t("div",[t("el-input",{staticStyle:{width:"250px","margin-right":"10px"},attrs:{placeholder:"搜索商品/操作人",size:"small",clearable:""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),t("el-button",{attrs:{type:"primary",icon:"el-icon-refresh",size:"small"},on:{click:e.fetchData}},[e._v("刷新")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.filteredData,border:"",stripe:""}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"modifyTime",label:"变动时间",width:"180",sortable:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("i",{staticClass:"el-icon-time"}),e._v(" "+e._s(a.row.modifyTime.replace("T"," "))+" ")]}}])}),t("el-table-column",{attrs:{prop:"product",label:"商品名称","min-width":"150",sortable:""}}),t("el-table-column",{attrs:{prop:"changeType",label:"变动类型",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{effect:"dark",type:["入库","采购入库","退货入库","调拨入库","盘盈入库"].includes(a.row.changeType)?"success":"danger"}},[e._v(" "+e._s(a.row.changeType)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"quantity",label:"变动数量",width:"120",align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{style:{color:"入库"===a.row.changeType?"#67C23A":"#F56C6C",fontWeight:"bold",fontSize:"15px"}},[e._v(" "+e._s("入库"===a.row.changeType?"+":"-")+e._s(a.row.quantity)+" ")])]}}])}),t("el-table-column",{attrs:{prop:"operator",label:"操作人",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small",type:"info"}},[e._v(e._s(a.row.operator))])]}}])}),t("el-table-column",{attrs:{prop:"note",label:"备注/关联单据","min-width":"200","show-overflow-tooltip":""}})],1)],1)],1)},ne=[],ce={name:"InventoryLogPage",data(){return{loading:!1,tableData:[],search:""}},computed:{filteredData(){if(!this.search)return this.tableData;const e=this.search.toLowerCase();return this.tableData.filter(t=>t.product&&t.product.toLowerCase().includes(e)||t.operator&&t.operator.toLowerCase().includes(e)||t.note&&t.note.toLowerCase().includes(e))}},created(){this.fetchData()},methods:{async fetchData(){this.loading=!0;try{const e=await this.$xhr.get("/inventoryLog/list");0===e.code&&(this.tableData=e.data)}catch(e){console.error(e)}finally{this.loading=!1}}}},de=ce,ue=(0,n.A)(de,ie,ne,!1,null,null,null),pe=ue.exports,me=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between"},attrs:{slot:"header"},slot:"header"},[t("div",{staticStyle:{"font-weight":"bold","font-size":"16px"}},[t("i",{staticClass:"el-icon-shopping-cart-2"}),e._v(" 商品销售 ")]),t("div",[t("el-button",{attrs:{icon:"el-icon-refresh",size:"small"},on:{click:e.fetchData}},[e._v("刷新")])],1)]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:16}},[t("el-card",{attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[e._v("商品列表")]),t("el-input",{staticStyle:{width:"200px","margin-bottom":"15px"},attrs:{placeholder:"输入商品名称搜索",size:"small",clearable:""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.filteredData,border:"","highlight-current-row":""},on:{"current-change":e.handleSelectProduct}},[t("el-table-column",{attrs:{prop:"proId",label:"ID",width:"60",align:"center"}}),t("el-table-column",{attrs:{prop:"proName",label:"商品名称","min-width":"150"}}),t("el-table-column",{attrs:{prop:"proCategory",label:"分类",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-tag",{attrs:{size:"small",type:"info"}},[e._v(e._s(a.row.proCategory))])]}}])}),t("el-table-column",{attrs:{prop:"proPrice",label:"单价",width:"100",sortable:"",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥ "+e._s(t.row.proPrice))]}}])}),t("el-table-column",{attrs:{prop:"proNum",label:"库存",width:"100",sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.proNum<=10?t("div",{staticStyle:{color:"red","font-weight":"bold"}},[t("i",{staticClass:"el-icon-warning"}),e._v(" "+e._s(a.row.proNum)+" ")]):t("div",{staticStyle:{color:"#67C23A","font-weight":"bold"}},[e._v(" "+e._s(a.row.proNum)+" ")])]}}])})],1)],1)],1),t("el-col",{attrs:{span:8}},[t("el-card",{staticStyle:{height:"100%"},attrs:{shadow:"never"}},[t("div",{attrs:{slot:"header"},slot:"header"},[e._v("销售信息")]),t("el-form",{ref:"saleForm",attrs:{model:e.saleForm,"label-width":"80px",rules:e.rules}},[t("el-form-item",{attrs:{label:"商品名称",prop:"proName"}},[t("el-input",{attrs:{disabled:""},model:{value:e.saleForm.proName,callback:function(t){e.$set(e.saleForm,"proName",t)},expression:"saleForm.proName"}})],1),t("el-form-item",{attrs:{label:"商品单价",prop:"unitPrice"}},[t("el-input",{attrs:{disabled:""},model:{value:e.saleForm.unitPrice,callback:function(t){e.$set(e.saleForm,"unitPrice",e._n(t))},expression:"saleForm.unitPrice"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"当前库存",prop:"stock"}},[t("el-input",{attrs:{disabled:""},model:{value:e.saleForm.stock,callback:function(t){e.$set(e.saleForm,"stock",e._n(t))},expression:"saleForm.stock"}})],1),t("el-form-item",{attrs:{label:"销售数量",prop:"quantity"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{min:1,max:e.saleForm.stock},on:{change:e.calculateTotal},model:{value:e.saleForm.quantity,callback:function(t){e.$set(e.saleForm,"quantity",t)},expression:"saleForm.quantity"}})],1),t("el-form-item",{attrs:{label:"总价",prop:"totalPrice"}},[t("el-input",{attrs:{disabled:""},model:{value:e.saleForm.totalPrice,callback:function(t){e.$set(e.saleForm,"totalPrice",e._n(t))},expression:"saleForm.totalPrice"}},[t("template",{slot:"append"},[e._v("元")])],2)],1),t("el-form-item",{attrs:{label:"客户姓名",prop:"customerName"}},[t("el-input",{attrs:{placeholder:"请输入客户姓名"},model:{value:e.saleForm.customerName,callback:function(t){e.$set(e.saleForm,"customerName",t)},expression:"saleForm.customerName"}})],1),t("el-form-item",{attrs:{label:"备注",prop:"remark"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入备注信息",rows:3},model:{value:e.saleForm.remark,callback:function(t){e.$set(e.saleForm,"remark",t)},expression:"saleForm.remark"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",disabled:!e.saleForm.proId||e.submitting,loading:e.submitting},on:{click:e.submitSale}},[e._v(" 确认销售 ")]),t("el-button",{staticStyle:{width:"100%","margin-top":"10px"},on:{click:e.resetForm}},[e._v(" 清空 ")])],1)],1)],1)],1)],1)],1),t("el-card",{staticStyle:{"margin-top":"20px"},attrs:{shadow:"never"}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between"},attrs:{slot:"header"},slot:"header"},[t("div",[e._v("销售记录")]),t("div",[t("el-date-picker",{staticStyle:{"margin-right":"10px"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small","value-format":"yyyy-MM-dd"},on:{change:e.fetchSalesRecords},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}}),t("el-button",{attrs:{icon:"el-icon-search",size:"small"},on:{click:e.fetchSalesRecords}},[e._v("查询")])],1)]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.recordsLoading,expression:"recordsLoading"}],staticStyle:{width:"100%"},attrs:{data:e.salesRecords,border:""}},[t("el-table-column",{attrs:{prop:"saleId",label:"销售编号",width:"100"}}),t("el-table-column",{attrs:{prop:"productName",label:"商品名称","min-width":"150"}}),t("el-table-column",{attrs:{prop:"quantity",label:"销售数量",width:"100",align:"center"}}),t("el-table-column",{attrs:{prop:"unitPrice",label:"单价",width:"100",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥ "+e._s(t.row.unitPrice))]}}])}),t("el-table-column",{attrs:{prop:"totalPrice",label:"总价",width:"100",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("¥ "+e._s(t.row.totalPrice))]}}])}),t("el-table-column",{attrs:{prop:"customerName",label:"客户姓名",width:"120"}}),t("el-table-column",{attrs:{prop:"saleTime",label:"销售时间",width:"180"}}),t("el-table-column",{attrs:{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}})],1),t("div",{staticStyle:{"text-align":"right","margin-top":"15px"}},[t("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalRecords},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)},he=[],fe={name:"SalesManagerPage",data(){return{loading:!1,recordsLoading:!1,submitting:!1,tableData:[],search:"",saleForm:{proId:null,proName:"",unitPrice:0,stock:0,quantity:1,totalPrice:0,customerName:"",remark:""},salesRecords:[],dateRange:[],currentPage:1,pageSize:10,totalRecords:0,rules:{quantity:[{required:!0,message:"请输入销售数量",trigger:"blur"},{type:"number",min:1,message:"销售数量必须大于0",trigger:"change"},{validator:(e,t,a)=>{t>this.saleForm.stock?a(new Error("销售数量不能超过当前库存")):a()},trigger:"change"}],customerName:[{required:!0,message:"请输入客户姓名",trigger:"blur"}]}}},computed:{filteredData(){return this.search?this.tableData.filter(e=>!this.search||e.proName.toLowerCase().includes(this.search.toLowerCase())):this.tableData}},created(){this.fetchData(),this.fetchSalesRecords()},methods:{async fetchData(){this.loading=!0;try{const e=await this.$xhr.get("/product/list");0===e.code&&(this.tableData=e.data)}catch(e){console.error(e)}finally{this.loading=!1}},handleSelectProduct(e){e&&(this.saleForm.proId=e.proId,this.saleForm.proName=e.proName,this.saleForm.unitPrice=e.proPrice,this.saleForm.stock=e.proNum,this.calculateTotal())},calculateTotal(){this.saleForm.totalPrice=parseFloat((this.saleForm.unitPrice*this.saleForm.quantity).toFixed(2))},resetForm(){this.saleForm={proId:null,proName:"",unitPrice:0,stock:0,quantity:1,totalPrice:0,customerName:"",remark:""},this.$refs.saleForm.resetFields()},async submitSale(){this.$refs.saleForm.validate(async e=>{if(e){this.submitting=!0;const e={proId:this.saleForm.proId,quantity:this.saleForm.quantity,unitPrice:this.saleForm.unitPrice,totalPrice:this.saleForm.totalPrice,customerName:this.saleForm.customerName,remark:this.saleForm.remark,operator:sessionStorage.getItem("username")||"管理员"};try{const t=await this.$xhr.post("/sales/add",e);0===t.code?(this.$message.success("销售成功"),this.resetForm(),this.fetchData(),this.fetchSalesRecords()):this.$message.error(t.msg||"销售失败")}catch(t){console.error(t),this.$message.error("销售过程中发生错误")}finally{this.submitting=!1}}})},async fetchSalesRecords(){this.recordsLoading=!0;try{const e={page:this.currentPage,size:this.pageSize};this.dateRange&&2===this.dateRange.length&&(e.startDate=this.dateRange[0],e.endDate=this.dateRange[1]);const t=await this.$xhr.get("/sales/list",{params:e});0===t.code&&(this.salesRecords=t.data.records,this.totalRecords=t.data.total)}catch(e){console.error(e)}finally{this.recordsLoading=!1}},handleSizeChange(e){this.pageSize=e,this.currentPage=1,this.fetchSalesRecords()},handleCurrentChange(e){this.currentPage=e,this.fetchSalesRecords()}}},ge=fe,be=(0,n.A)(ge,me,he,!1,null,"5528d956",null),ve=be.exports;o["default"].use(u.Ay);const ye=new u.Ay({routes:[{path:"/login",name:"Login",component:b},{path:"/newUser",name:"NewUser",component:le},{path:"/",redirect:"/login"},{path:"/welcome",name:"Welcome",component:x,redirect:"/welcome/dashboard",children:[{path:"dashboard",name:"Dashboard",component:P,meta:{title:"数据可视化"}},{path:"products",name:"ProductManager",component:V,meta:{title:"商品管理"}},{path:"documents",name:"DocumentManager",component:j,meta:{title:"单据管理"}},{path:"locations",name:"LocationManager",component:G,meta:{title:"库位管理"}},{path:"users",name:"UserManager",component:ee,meta:{title:"用户管理"}},{path:"logs",name:"InventoryLog",component:pe,meta:{title:"库存日志"}},{path:"sales",name:"SalesManager",component:ve,meta:{title:"销售管理"}}]}]});ye.beforeEach((e,t,a)=>{const r=sessionStorage.getItem("token"),s=sessionStorage.getItem("roleId");"/login"===e.path||"/newUser"===e.path||r?e.path.includes("/users")&&"1"!==s?(o["default"].prototype.$message.warning("权限不足，无法访问用户管理"),a("/welcome/dashboard")):a():a("/login")});var we=ye,ke=a(1524),_e=a.n(ke),xe=a(4373);xe.A.defaults.baseURL="http://localhost:8888",xe.A.defaults.timeout=5e3,xe.A.interceptors.request.use(e=>{const t=sessionStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),xe.A.interceptors.response.use(e=>e.data,e=>{if(console.log(e),e.response){var t=e.response.status;switch(t){case 400:o["default"].prototype.$message.error(`请求错误: ${e.message}`);break;case 401:o["default"].prototype.$message.error("未授权，请重新登录");break;case 403:o["default"].prototype.$message.error("拒绝访问");break;case 404:o["default"].prototype.$message.error("请求地址不存在");break;case 500:o["default"].prototype.$message.error("服务器内部错误");break;case 502:o["default"].prototype.$message.error("网关错误");break;case 503:o["default"].prototype.$message.error("服务不可用");break;default:o["default"].prototype.$message.error(`网络错误: ${e.message}`)}}else e.request?o["default"].prototype.$message.error(e):o["default"].prototype.$message.error(`请求配置错误: ${e.message}`);return Promise.reject(e)}),o["default"].prototype.$xhr=xe.A,o["default"].use(_e()),o["default"].config.productionTip=!1,new o["default"]({router:we,render:e=>e(d)}).$mount("#app")}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(s.exports,s,s.exports,a),s.loaded=!0,s.exports}a.m=e,function(){a.amdO={}}(),function(){var e=[];a.O=function(t,o,r,s){if(!o){var l=1/0;for(d=0;d<e.length;d++){o=e[d][0],r=e[d][1],s=e[d][2];for(var i=!0,n=0;n<o.length;n++)(!1&s||l>=s)&&Object.keys(a.O).every(function(e){return a.O[e](o[n])})?o.splice(n--,1):(i=!1,s<l&&(l=s));if(i){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[o,r,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,s,l=o[0],i=o[1],n=o[2],c=0;if(l.some(function(t){return 0!==e[t]})){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(n)var d=n(a)}for(t&&t(o);c<l.length;c++)s=l[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(d)},o=self["webpackChunkvue_cli_demo"]=self["webpackChunkvue_cli_demo"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=a.O(void 0,[504],function(){return a(5936)});o=a.O(o)})();
//# sourceMappingURL=app.434e55c3.js.map